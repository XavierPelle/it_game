<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
    <meta name="author" content="AdminKit">
    <meta name="keywords"
        content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="shortcut icon" href="img/icons/icon-48x48.png" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <link rel="canonical" href="https://demo-basic.adminkit.io/" />

    <title>AdminKit Demo - Bootstrap 5 Admin Template</title>

    <link href="css/app.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<style>
    .card-body-url {
        max-height: 280px;
        overflow-y: auto;
    }

    .card-body-ip {
        max-height: 500px;
        overflow-y: auto;
        background-color: white;
    }

    .table-containers {
        max-height: 400px;
        overflow-y: auto;
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    }

    .table th,
    .table td {
        vertical-align: middle;
    }
</style>

<body>
    <div class="wrapper">

        <div class="main">
            <div id="alerts-container"></div>


            <main class="content">
                <div class="container-fluid p-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="h3 mb-3"><strong>Analytics</strong> Dashboard</h1>
                        <button id="submitButton" class="btn btn-primary btn-lg mb-2">Envoyer la requête</button>
                    </div>


                    <div class="row">
                        <div class="col-xl-6 col-xxl-5 d-flex">
                            <div class="w-100">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="card dashboard-card">
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col mt-0">
                                                        <h5 class="card-title">Nombre de lignes analysées
                                                    </div>


                                                </div>
                                                <h1 id="logs_length" class="mt-1 mb-3"></h1>
                                                <div class="mb-0">
                                                    <span class="text-danger"> <i
                                                            class="mdi mdi-arrow-bottom-right"></i> </span>
                                                    <span class="text-muted"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card dashboard-card">
                                            <div class="card-body">
                                                <h5 class="card-title">Importer PCAP</h5>
                                                <input type="file" id="pcapFileInput" name="file" />
                                                <button class="btn btn-dark mt-2"
                                                    onclick="uploadPCAP()">Importer</button>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="col-sm-6">
                                        <div class="card dashboard-card">
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col mt-0">
                                                        <h5 class="card-title">Télécharger le fichier depuis l'API</h5>
                                                        <button class="btn btn-primary"
                                                            onclick="downloadPCAP()">Télécharger</button>
                                                    </div>


                                                </div>
                                                <h1 class="mt-1 mb-3"></h1>
                                                <div class="mb-0">
                                                    <span class="text-success"> <i
                                                            class="mdi mdi-arrow-bottom-right"></i> </span>
                                                    <span class="text-muted"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card dashboard-card">
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col mt-0">
                                                        <h5 class="card-title">Decoder et Analyser</h5>
                                                        <button class="btn btn-success"
                                                            onclick="analyzePCAP()">Analyser</button>
                                                    </div>


                                                </div>

                                                <h1 class="mt-1 mb-3"></h1>
                                                <div class="mb-0">
                                                    <span class="text-danger"> <i
                                                            class="mdi mdi-arrow-bottom-right"></i> </span>
                                                    <span class="text-muted"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="col-xl-6 col-xxl-7 scrolls">
                            <div class="card flex-fill w-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">URL</h5>
                                </div>
                                <div class="card-body-url  py-3">
                                    <table class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>URL</th>
                                                <th>Occurrence</th>
                                            </tr>
                                        </thead>
                                        <tbody id="movementTableBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
                            <div class="card flex-fill w-100">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Type de trame</h5>
                                </div>
                                <div class="card-body d-flex">
                                    <div class="align-self-center w-100">
                                        <div class="py-3">
                                            <div class="chart chart-xs">
                                                <canvas id="chartjs-dashboard-pie"></canvas>
                                            </div>
                                        </div>

                                        <table class="table mb-0">
                                            <tbody id="table-body">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-12 col-xxl-6 d-flex order-3 order-xxl-2">
                            <div class="card flex-fill w-100">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Real-Time</h5>
                                </div>
                                <div class="card-body px-4">
                                    <div id="world_map" style="height:350px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 col-xxl-3 d-flex order-1 order-xxl-1">
                            <div class="card flex-fill">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Calendar</h5>
                                </div>
                                <div class="card-body d-flex">
                                    <div class="align-self-center w-100">
                                        <div class="chart">
                                            <div id="datetimepicker-dashboard"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-lg-8 col-xxl-9 d-flex card-body-ip">
                            <div class=" flex-fill">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Liste des adresses IP, MAC et DNS</h5>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <table id="ipMacDnsTable" class="table table-hover my-0">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>MAC source</th>
                                                    <th>IP source</th>
                                                    <th>Nom NetBios</th>
                                                    <th>MAC Destination</th>
                                                    <th>IP Destination</th>
                                                    <th>Nom DNS</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-4 col-xxl-3 d-flex">
                            <div class="card flex-fill w-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Authentification Windows</h5>
                                </div>
                                <div class="card-body d-flex w-100">
                                    <div class="align-self-center chart chart-lg">
                                        <canvas id="chartjs-dashboard-bar"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="mt-3">
                    <div class="d-flex">
                        <div class="card flex-fill">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Ports TCP sources / distants</h5>
                            </div>
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <canvas id="srcChart"></canvas>
                                    <p class="align-center">Sources</p>
                                </div>
                                <div class="col-12 col-md-6">
                                    <canvas id="dstChart"></canvas>
                                    <p>Distants</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Tentatives scans réseaux</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-containers">
                                    <table id="tableScan" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Tentatives</th>
                                                <th>IP source</th>
                                                <th>Port</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">HTTP suspects</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-containers">
                                    <table id="tableScanURI" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>IP source</th>
                                                <th>Destination</th>
                                                <th>URI</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Scan HTTP</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-containers">
                                    <table id="tableScanHttp" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>IP sourcese</th>
                                                <th>Commande </th>
                                                <th>Argument</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Téléchargement Web</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-containers">
                                    <table id="tableScanDl" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>IP source</th>
                                                <th>IP destination</th>
                                                <th>Code HTTP</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Téléchargement via url</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-containers">
                                    <table id="tableScanDLURL" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>IP source</th>
                                                <th>Destination web</th>
                                                <th>URI</th>
                                                <th>Type</th>
                                                <th>Taille</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Analyse RDP Traffic</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-containers">
                                    <table id="tableRdpTraffic" class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>IP source</th>
                                                <th>IP destination</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        </main>
    </div>
    <script src="js/app.js"></script>


    <script>




        let displayData = (data) => {
            console.log(data)
            function fillTable(tableId, data) {
                const tableBody = document.querySelector(`#${tableId} tbody`);
                const tableContainer = document.querySelector(`#${tableId}`).closest('.card');
                tableBody.innerHTML = '';

                if (data.length === 0) {
                    tableContainer.style.display = 'none';
                } else {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        Object.values(item).forEach(value => {
                            const td = document.createElement('td');
                            td.textContent = value;
                            row.appendChild(td);
                        });
                        tableBody.appendChild(row);
                    });

                    tableContainer.style.display = 'block';
                }
            }

            fillTable('tableScan', data.scan);
            fillTable('tableScanURI', data.scanURI);
            fillTable('tableScanHttp', data.scanHttp);
            fillTable('tableScanDl', data.scanDl);
            fillTable('tableScanDLURL', data.scanDLURL);
            fillTable('tableRdpTraffic', data.analyzeRdpTraffic);


            function submitResultsToApi() {
                fetch('http://localhost:8101/flag', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.flag) {
                            console.log("Flag reçu:", data.flag);
                            console.log("Data:", data.data);

                            showAlert(data.flag, data.data);
                        } else if (data.error) {
                            console.log("Erreur:", data.error);
                            showErrorAlert(data.error);
                        }
                    })
                    .catch(error => {
                        console.error('Erreur lors de l\'envoi:', error);
                    });
            }

            function showAlert(flag, data) {
                const alertDiv = document.createElement('div');
                alertDiv.classList.add('alert', 'alert-success', 'alert-dismissible', 'fade', 'show');
                alertDiv.setAttribute('role', 'alert');

                alertDiv.innerHTML = `
        <strong>Flag reçu:</strong> ${flag} <br>
        <strong>Data:</strong> ${JSON.stringify(data, null, 2)} 
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    `;

                const alertsContainer = document.getElementById('alerts-container');
                alertsContainer.innerHTML = '';
                alertsContainer.appendChild(alertDiv);

                setTimeout(() => {
                    alertDiv.classList.remove('show');
                    alertDiv.classList.add('fade');
                }, 5000);
            }

            function showErrorAlert(error) {
                const alertDiv = document.createElement('div');
                alertDiv.classList.add('alert', 'alert-danger', 'alert-dismissible', 'fade', 'show');
                alertDiv.setAttribute('role', 'alert');

                alertDiv.innerHTML = `
        <strong>Erreur:</strong> ${error} 
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    `;

                const alertsContainer = document.getElementById('alerts-container');
                alertsContainer.innerHTML = '';
                alertsContainer.appendChild(alertDiv);

                setTimeout(() => {
                    alertDiv.classList.remove('show');
                    alertDiv.classList.add('fade');
                }, 5000);
            }

            document.getElementById('submitButton').addEventListener('click', function () {
                console.log("Envoi de la requête GET à /flag");
                submitResultsToApi();
            });





            function populateTable(tableId, data) {
                const safeDomains = [
                    'microsoft.com', 'google.com', 'facebook.com', 'twitter.com', 'apple.com', 'th.bing.com', 'windows.com',
                    'windowsupdate.com', 'windows.msn.com', 'www.msn.com', 'api.msn.com', 'amazon.com', 'youtube.com',
                    'linkedin.com', 'instagram.com', 'yahoo.com', 'www.bing.com', 'dropbox.com', 'github.com', 'slack.com',
                    'zoom.us', 'icloud.com', 'paypal.com', 'paypalobjects.com', 'square.com', 'adobe.com', 'shopify.com',
                    'bankofamerica.com', 'chase.com', 'wellsfargo.com', 'capitalone.com', 'vimeo.com', 'pinterest.com',
                    'reddit.com', 'twitch.tv', 'spotify.com', 'netflix.com', 'hulu.com', 'ebay.com', 'craigslist.org',
                    'etsy.com', 'walmart.com', 'target.com', 'costco.com', 'bestbuy.com', 'fiverr.com', 'airbnb.com',
                    'expedia.com', 'booking.com', 'skyscanner.com', 'travelocity.com', 'priceline.com', 'tripadvisor.com',
                    'yelp.com', 'tumblr.com', 'medium.com', 'theguardian.com', 'bbc.com', 'cnn.com', 'nytimes.com',
                    'wsj.com', 'forbes.com', 'reuters.com', 'bloomberg.com', 'bbc.co.uk', 'ft.com', 'theverge.com',
                    'wired.com', 'techcrunch.com', 'venturebeat.com', 'gizmodo.com', 'engadget.com', 'androidcentral.com',
                    'thebrowsercompany.com', 'mozilla.org', 'ubuntu.com', 'debian.org', 'redhat.com', 'archlinux.org',
                    'gentoo.org', 'kde.org', 'gnome.org', 'docker.com', 'kubectl.com', 'hashicorp.com', 'terraform.io',
                    'jenkins.io', 'nginx.org', 'nodejs.org', 'expressjs.com', 'reactjs.org', 'vuejs.org', 'angular.io',
                    'webpack.js.org', 'vuejs.org', 'npmjs.com', 'rubyonrails.org', 'python.org', 'java.com', 'go.dev',
                    'jetbrains.com', 'intellij.com', 'maven.apache.org', 'gradle.org', 'yarnpkg.com', 'githubusercontent.com',
                    'stackoverflow.com', 'oracle.com', 'salesforce.com', 'sap.com', 'servicenow.com', 'intuit.com',
                    'zoom.com', 'zoom.us', 't.co', 'pipedrive.com', 'twilio.com', 'stripe.com', 'sendgrid.com',
                    'twilio.com', 'mailchimp.com', 'sendinblue.com', 'freshdesk.com', 'zendesk.com', 'atlassian.com',
                    'jira.com', 'confluence.com', 'bitbucket.org', 'heroku.com', 'digitalocean.com', 'aws.amazon.com',
                    'azure.microsoft.com', 'googlecloud.com', 'ibm.com', 'oraclecloud.com', 'alibaba.com', 'salesforce.com',
                    'kaltura.com', 'brightcove.com', 'videolan.org', 'cloudflare.com', 'akamai.com', 'fastly.com',
                    'rackspace.com', 'wpengine.com', 'siteground.com', 'bluehost.com', 'godaddy.com', 'hostgator.com', 'DESKTOP*', 'login.microsoftonline.com', 'login.live.com', 'assets.msn.com'
                ];

                const unsafeDomains = [
                    '*.xyz', '*.tk', '*.club', '*.top', '*.pw', '*.cf', '*.ga', '*.gq', '*.ml', '*.xyz', '*.work',
                    '*.online', '*.click', '*.win', '*.party', '*.pw', '*.info', '*.ru', '*.io', '*.fun', '*.ga',
                    'bit.ly', 't.co', '*.top', '*.work', '*.download', '*.zip', '*.exe', '*.apk',
                ];

                const tableBody = document.querySelector(`#${tableId} tbody`);
                tableBody.innerHTML = '';

                const rows = data.map(({ time, src_mac, src_ip, nbns_name, dst_mac, dst_ip, dns_query_name }) => {
                    const formattedTime = formatDate(time);
                    const srcIpLink = createIpLink(src_ip);
                    const dstIpLink = createIpLink(dst_ip);
                    const backgroundColor = getBackgroundColor(dns_query_name, safeDomains, unsafeDomains);

                    return `
            <tr style="background-color: ${backgroundColor}">
                <td style="white-space: nowrap">${formattedTime}</td>
                <td>${src_mac}</td>
                <td>${srcIpLink}</td>
                <td>${nbns_name}</td>
                <td>${dst_mac}</td>
                <td>${dstIpLink}</td>
                <td>${dns_query_name}</td>
            </tr>
        `;
                }).join('');

                tableBody.innerHTML = rows;
            }

            function createIpLink(ip) {
                return `<a href="http://localhost:8101/analyzeIP?ip=${ip}" target="_blank">${ip}</a>`;
            }

            function getBackgroundColor(dnsQueryName, safeDomains, unsafeDomains) {
                const isSafeDomain = safeDomains.some(pattern => {
                    const regex = new RegExp(pattern.replace('*', '.*'));
                    return regex.test(dnsQueryName);
                });

                const isUnsafeDomain = unsafeDomains.some(pattern => {
                    const regex = new RegExp(pattern.replace('*', '.*'));
                    return regex.test(dnsQueryName);
                });

                if (isSafeDomain) {
                    return '#b3e6b3';
                }
                if (isUnsafeDomain) {
                    return '#ffb3b3';
                }
                return '#ffcc99';
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                const options = {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                };
                return date.toLocaleString('en-US', options);
            }

            populateTable('ipMacDnsTable', data.mac);




            const logsLength = document.querySelector("#logs_length");
            logsLength.innerHTML = data.logs_length;

            new Chart(document.getElementById("chartjs-dashboard-pie"), {
                type: "pie",
                data: {
                    labels: ["Trames Ethernet", "Trames IPv4", "Trames UDP", "Trames TCP", "Trames Kerberos"],
                    datasets: [{
                        data: [data.ethernet_frames, data.ipv4_frames, data.udp_frames, data.tcp_frames, data.kerberos_frames],
                        backgroundColor: [
                            "#3498db",
                            "#f39c12",
                            "#e74c3c",
                            "#2ecc71",
                            "#1abc9c"
                        ],
                        borderWidth: 5
                    }]
                },
                options: {
                    responsive: !window.MSInputMethodContext,
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    cutoutPercentage: 75
                }
            });

            const tableBody = document.getElementById("table-body");
            tableBody.innerHTML = `
        <tr>
            <td>Ethernet</td>
            <td class="text-end">${data.ethernet_frames}</td>
        </tr>
        <tr>
            <td>IPv4</td>
            <td class="text-end">${data.ipv4_frames}</td>
        </tr>
        <tr>
            <td>UDP</td>
            <td class="text-end">${data.udp_frames}</td>
        </tr>
        <tr>
            <td>TCP</td>
            <td class="text-end">${data.tcp_frames}</td>
        </tr>
        <tr>
            <td>Kerberos</td>
            <td class="text-end">${data.kerberos_frames}</td>
        </tr>
    `;

            const labels = Object.keys(data.kerberos_services);
            const occ = Object.values(data.kerberos_services);

            new Chart(document.getElementById("chartjs-dashboard-bar"), {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Logs en cours",
                        backgroundColor: window.theme.primary,
                        borderColor: window.theme.primary,
                        hoverBackgroundColor: window.theme.primary,
                        hoverBorderColor: window.theme.primary,
                        data: occ,
                        barPercentage: 0.75,
                        categoryPercentage: 0.5
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    scales: {
                        yAxes: [{
                            gridLines: {
                                display: false
                            },
                            stacked: false,
                            ticks: {
                                stepSize: 5
                            }
                        }],
                        xAxes: [{
                            stacked: false,
                            gridLines: {
                                color: "transparent"
                            }
                        }]
                    }
                }
            });

            function sortUrlData(urlLabels, urlOcc) {
                const combined = urlLabels.map((label, index) => [label, urlOcc[index]]);

                combined.sort((a, b) => b[1] - a[1]);

                const sortedLabels = combined.map(item => item[0]);
                const sortedOcc = combined.map(item => item[1]);

                return { sortedLabels, sortedOcc };
            }

            const urlLabels = Object.keys(data.url);
            const urlOcc = Object.values(data.url);

            const { sortedLabels, sortedOcc } = sortUrlData(urlLabels, urlOcc);

            const tableurlBody = document.getElementById('movementTableBody');

            sortedLabels.forEach((label, index) => {
                const row = document.createElement('tr');
                const urlCell = document.createElement('td');
                const occurrenceCell = document.createElement('td');

                const urlLink = document.createElement('a');
                urlLink.href = `analyzeURL?urls=${encodeURIComponent(label)}`;
                urlLink.textContent = label;
                urlLink.target = '_blank';

                urlCell.appendChild(urlLink);

                occurrenceCell.textContent = sortedOcc[index];

                row.appendChild(urlCell);
                row.appendChild(occurrenceCell);

                tableurlBody.appendChild(row);
            });

            const srcLabels = Object.keys(data.tcp_ports);
            const srcOccurrences = Object.values(data.tcp_ports);

            const dstLabels = Object.keys(data.dst_ports);
            const dstOccurrences = Object.values(data.dst_ports);

            const colors = [
                "#ff6384", "#36a2eb", "#ffcd56", "#2ecc71", "#1abc9c",
                "#f39c12", "#e74c3c", "#9b59b6", "#3498db", "#1abc9c",
                "#16a085", "#2ecc71", "#f1c40f", "#e67e22", "#95a5a6",
                "#34495e", "#f39c12", "#9b59b6", "#8e44ad", "#2980b9",
                "#2c3e50", "#c0392b", "#16a085", "#27ae60", "#8e44ad",
                "#f39c12", "#1abc9c", "#9b59b6", "#e74c3c", "#16a085",
            ];

            const srcData = {
                labels: srcLabels,
                datasets: [{
                    data: srcOccurrences,
                    backgroundColor: colors.slice(0, srcLabels.length),
                    hoverBackgroundColor: colors.slice(0, srcLabels.length),
                }]
            };

            const dstData = {
                labels: dstLabels,
                datasets: [{
                    data: dstOccurrences,
                    backgroundColor: colors.slice(0, dstLabels.length),
                    hoverBackgroundColor: colors.slice(0, dstLabels.length),
                }]
            };


            const ctxSrc = document.getElementById('srcChart').getContext('2d');
            const srcChart = new Chart(ctxSrc, {
                type: 'doughnut',
                data: srcData,
                options: {
                    cutoutPercentage: 50,
                }
            });

            const ctxDst = document.getElementById('dstChart').getContext('2d');
            const dstChart = new Chart(ctxDst, {
                type: 'doughnut',
                data: dstData,
                options: {
                    cutoutPercentage: 50,
                }
            });

        }

        fetch('http://localhost:8101/dashboard')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                displayData(data);
            })
            .catch(error => {
                console.error('Error fetching dashboard:', error);
            });


    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var date = new Date(Date.now() - 5 * 24 * 60 * 60 * 1000);
            var defaultDate = date.getUTCFullYear() + "-" + (date.getUTCMonth() + 1) + "-" + date.getUTCDate();
            document.getElementById("datetimepicker-dashboard").flatpickr({
                inline: true,
                prevArrow: "<span title=\"Previous month\">&laquo;</span>",
                nextArrow: "<span title=\"Next month\">&raquo;</span>",
                defaultDate: defaultDate
            });
        });
    </script>


    <script src="js/app.js"></script>

    <script>


        function downloadPCAP() {
            fetch("http://localhost:8101/fetch-logs")
                .then(response => response.text())
                .then(message => {
                    alert(message); // te montre "Fichier téléchargé avec succès : ./src/Logs/logs"
                })
                .catch(error => alert("Erreur de téléchargement depuis l'API : " + error));
        }

        function uploadPCAP() {
            const fileInput = document.getElementById("pcapFileInput");
            const file = fileInput.files[0];

            if (!file) {
                alert("Veuillez sélectionner un fichier PCAP.");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            fetch("http://localhost:8101/upload", {
                method: "POST",
                body: formData
            })
                .then(response => {
                    // On vérifie si le backend retourne bien du JSON
                    const contentType = response.headers.get("content-type");
                    if (contentType && contentType.indexOf("application/json") !== -1) {
                        return response.json();
                    } else {
                        return response.text().then(text => { throw new Error(text); });
                    }
                })
                .then(result => {
                    // Si success = true dans le JSON
                    if (result.success) {
                        alert(result.message); // ex: Fichier PCAP importé sur le serveur : ./src/Logs/logs
                    } else {
                        alert("Erreur : " + result.message);
                    }
                })
                .catch(error => {
                    console.error("Erreur upload :", error);
                    alert("Erreur inattendue lors de l'import : " + error.message);
                });
        }



        function analyzePCAP() {
            fetch("http://localhost:8101/analyze")
                .then(response => {
                    if (!response.ok) throw new Error("Erreur d'analyse");
                    return response.json();
                })
                .then(data => {
                    displayData(data);
                })
                .catch(error => alert("Erreur d'analyse : Failed to fetch"));
        }



        fetch('http://localhost:8101/dashboard')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                displayData(data);
            })
            .catch(error => {
                console.error('Error fetching dashboard:', error);
            });
    </script>

    <script>

        function uploadPCAP() {
            const fileInput = document.getElementById("pcapFileInput");
            const file = fileInput.files[0];

            if (!file) {
                alert("Veuillez sélectionner un fichier PCAP.");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            fetch("http://localhost:8101/upload", {
                method: "POST",
                body: formData
            })
                .then(response => response.json())
                .then(result => {
                    alert(result.message);
                    console.log(result);
                })
                .catch(error => {
                    alert("Erreur JS : " + error.message);
                    console.error(error);
                });
        }



        function analyzePCAP() {
            // 1. On décode les logs
            fetch("http://localhost:8101/decode-logs")
                .then(response => {
                    if (!response.ok) throw new Error("Échec du décodage");
                    return response.text();
                })
                .then(() => {
                    // 2. Puis on recharge la page pour voir les nouvelles données
                    window.location.reload();
                })
                .catch(error => alert("Erreur lors de l'analyse : " + error.message));
        }
    </script>


    <style>
        .dashboard-card {
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }


        .dashboard-card .card-body {
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }


        .dashboard-card h5 {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .dashboard-card h1 {
            font-size: 2rem;
            font-weight: bold;
            margin: 0;
        }

        .dashboard-card input[type="file"] {
            margin-bottom: 10px;
            width: 90%;
            text-align: center;
        }
    </style>



</body>

</html>



<script>
    document.addEventListener("DOMContentLoaded", function () {
        var markers = [{
            coords: [31.230391, 121.473701],
            name: "Shanghai"
        },
        {
            coords: [28.704060, 77.102493],
            name: "Delhi"
        },
        {
            coords: [6.524379, 3.379206],
            name: "Lagos"
        },
        {
            coords: [35.689487, 139.691711],
            name: "Tokyo"
        },
        {
            coords: [23.129110, 113.264381],
            name: "Guangzhou"
        },
        {
            coords: [40.7127837, -74.0059413],
            name: "New York"
        },
        {
            coords: [34.052235, -118.243683],
            name: "Los Angeles"
        },
        {
            coords: [41.878113, -87.629799],
            name: "Chicago"
        },
        {
            coords: [51.507351, -0.127758],
            name: "London"
        },
        {
            coords: [40.416775, -3.703790],
            name: "Madrid "
        }
        ];
        var map = new jsVectorMap({
            map: "world",
            selector: "#world_map",
            zoomButtons: true,
            markers: markers,
            markerStyle: {
                initial: {
                    r: 9,
                    strokeWidth: 7,
                    stokeOpacity: .4,
                    fill: window.theme.primary
                },
                hover: {
                    fill: window.theme.primary,
                    stroke: window.theme.primary
                }
            },
            zoomOnScroll: false
        });
        window.addEventListener("resize", () => {
            map.updateSize();
        });
    });
</script>
</body>

</html>