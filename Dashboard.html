<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Responsive Admin &amp; Dashboard Template based on Bootstrap 5">
    <meta name="author" content="AdminKit">
    <meta name="keywords"
        content="adminkit, bootstrap, bootstrap 5, admin, dashboard, template, responsive, css, sass, html, theme, front-end, ui kit, web">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="shortcut icon" href="img/icons/icon-48x48.png" />

    <link rel="canonical" href="https://demo-basic.adminkit.io/" />

    <title>AdminKit Demo - Bootstrap 5 Admin Template</title>

    <link href="css/app.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<style>
    .card-body-url {
        max-height: 280px;
        overflow-y: auto;
    }

    .card-body-ip {
        max-height: 500px;
        overflow-y: auto;
        background-color: white;
    }
</style>

<body>
    <div class="wrapper">

        <div class="main">
            <nav class="navbar navbar-expand navbar-light navbar-bg">
                <a class="sidebar-toggle js-sidebar-toggle">
                    <i class="hamburger align-self-center"></i>
                </a>

                <div class="navbar-collapse collapse">
                    <ul class="navbar-nav navbar-align">
                        <li class="nav-item dropdown">
                            <a class="nav-icon dropdown-toggle" href="#" id="alertsDropdown" data-bs-toggle="dropdown">
                                <div class="position-relative">
                                    <i class="align-middle" data-feather="bell"></i>
                                    <span class="indicator">4</span>
                                </div>
                            </a>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0"
                                aria-labelledby="alertsDropdown">
                                <div class="dropdown-menu-header">
                                    4 New Notifications
                                </div>
                                <div class="list-group">
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <i class="text-danger" data-feather="alert-circle"></i>
                                            </div>
                                            <div class="col-10">
                                                <div class="text-dark">Update completed</div>
                                                <div class="text-muted small mt-1">Restart server 12 to complete the
                                                    update.</div>
                                                <div class="text-muted small mt-1">30m ago</div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <i class="text-warning" data-feather="bell"></i>
                                            </div>
                                            <div class="col-10">
                                                <div class="text-dark">Lorem ipsum</div>
                                                <div class="text-muted small mt-1">Aliquam ex eros, imperdiet vulputate
                                                    hendrerit et.</div>
                                                <div class="text-muted small mt-1">2h ago</div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <i class="text-primary" data-feather="home"></i>
                                            </div>
                                            <div class="col-10">
                                                <div class="text-dark">Login from 192.186.1.8</div>
                                                <div class="text-muted small mt-1">5h ago</div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <i class="text-success" data-feather="user-plus"></i>
                                            </div>
                                            <div class="col-10">
                                                <div class="text-dark">New connection</div>
                                                <div class="text-muted small mt-1">Christina accepted your request.
                                                </div>
                                                <div class="text-muted small mt-1">14h ago</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="dropdown-menu-footer">
                                    <a href="#" class="text-muted">Show all notifications</a>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-icon dropdown-toggle" href="#" id="messagesDropdown"
                                data-bs-toggle="dropdown">
                                <div class="position-relative">
                                    <i class="align-middle" data-feather="message-square"></i>
                                </div>
                            </a>
                            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0"
                                aria-labelledby="messagesDropdown">
                                <div class="dropdown-menu-header">
                                    <div class="position-relative">
                                        4 New Messages
                                    </div>
                                </div>
                                <div class="list-group">
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <img src="img/avatars/avatar-5.jpg"
                                                    class="avatar img-fluid rounded-circle" alt="Vanessa Tucker">
                                            </div>
                                            <div class="col-10 ps-2">
                                                <div class="text-dark">Vanessa Tucker</div>
                                                <div class="text-muted small mt-1">Nam pretium turpis et arcu. Duis arcu
                                                    tortor.</div>
                                                <div class="text-muted small mt-1">15m ago</div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <img src="img/avatars/avatar-2.jpg"
                                                    class="avatar img-fluid rounded-circle" alt="William Harris">
                                            </div>
                                            <div class="col-10 ps-2">
                                                <div class="text-dark">William Harris</div>
                                                <div class="text-muted small mt-1">Curabitur ligula sapien euismod
                                                    vitae.</div>
                                                <div class="text-muted small mt-1">2h ago</div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <img src="img/avatars/avatar-4.jpg"
                                                    class="avatar img-fluid rounded-circle" alt="Christina Mason">
                                            </div>
                                            <div class="col-10 ps-2">
                                                <div class="text-dark">Christina Mason</div>
                                                <div class="text-muted small mt-1">Pellentesque auctor neque nec urna.
                                                </div>
                                                <div class="text-muted small mt-1">4h ago</div>
                                            </div>
                                        </div>
                                    </a>
                                    <a href="#" class="list-group-item">
                                        <div class="row g-0 align-items-center">
                                            <div class="col-2">
                                                <img src="img/avatars/avatar-3.jpg"
                                                    class="avatar img-fluid rounded-circle" alt="Sharon Lessman">
                                            </div>
                                            <div class="col-10 ps-2">
                                                <div class="text-dark">Sharon Lessman</div>
                                                <div class="text-muted small mt-1">Aenean tellus metus, bibendum sed,
                                                    posuere ac, mattis non.</div>
                                                <div class="text-muted small mt-1">5h ago</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                                <div class="dropdown-menu-footer">
                                    <a href="#" class="text-muted">Show all messages</a>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#"
                                data-bs-toggle="dropdown">
                                <i class="align-middle" data-feather="settings"></i>
                            </a>

                            <a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#"
                                data-bs-toggle="dropdown">
                                <img src="img/avatars/avatar.jpg" class="avatar img-fluid rounded me-1"
                                    alt="Charles Hall" /> <span class="text-dark">Charles Hall</span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end">
                                <a class="dropdown-item" href="pages-profile.html"><i class="align-middle me-1"
                                        data-feather="user"></i> Profile</a>
                                <a class="dropdown-item" href="#"><i class="align-middle me-1"
                                        data-feather="pie-chart"></i> Analytics</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="index.html"><i class="align-middle me-1"
                                        data-feather="settings"></i> Settings & Privacy</a>
                                <a class="dropdown-item" href="#"><i class="align-middle me-1"
                                        data-feather="help-circle"></i> Help Center</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Log out</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>

            <main class="content">
                <div class="container-fluid p-0">

                    <h1 class="h3 mb-3"><strong>Analytics</strong> Dashboard</h1>

                    <div class="row">
                        <div class="col-xl-6 col-xxl-5 d-flex">
                            <div class="w-100">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="card dashboard-card">
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col mt-0">
                                                        <h5 class="card-title">Nombre de lignes analysées
                                                    </div>

                                                    
                                                </div>
                                                <h1 id="logs_length" class="mt-1 mb-3"></h1>
                                                <div class="mb-0">
                                                    <span class="text-danger"> <i
                                                            class="mdi mdi-arrow-bottom-right"></i> </span>
                                                    <span class="text-muted"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card dashboard-card">
                                            <div class="card-body">
                                                <h5 class="card-title">Importer PCAP</h5>
                                                <input type="file" id="pcapFileInput" name="file" />
                                                <button class="btn btn-dark mt-2" onclick="uploadPCAP()">Importer</button>
                                            </div>
                                        </div>
                                        
                                    </div>
                                    <div class="col-sm-6">
                                        <div class="card dashboard-card">
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col mt-0">
                                                        <h5 class="card-title">Télécharger le fichier depuis l'API</h5>
                                                        <button class="btn btn-primary" onclick="downloadPCAP()">Télécharger</button>
                                                    </div>

                                                    
                                                </div>
                                                <h1 class="mt-1 mb-3"></h1>
                                                <div class="mb-0">
                                                    <span class="text-success"> <i
                                                            class="mdi mdi-arrow-bottom-right"></i> </span>
                                                    <span class="text-muted"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card dashboard-card">
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col mt-0">
                                                        <h5 class="card-title">Decoder et Analyser</h5>
                                                        <button class="btn btn-success" onclick="analyzePCAP()">Analyser</button>
                                                    </div>

                                                    
                                                </div>

                                                <h1 class="mt-1 mb-3"></h1>
                                                <div class="mb-0">
                                                    <span class="text-danger"> <i
                                                            class="mdi mdi-arrow-bottom-right"></i>  </span>
                                                    <span class="text-muted"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                            

                        <div class="col-xl-6 col-xxl-7 scrolls">
                            <div class="card flex-fill w-100">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Recent Movement</h5>
                                </div>
                                <div class="card-body-url  py-3">
                                    <table class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>URL</th>
                                                <th>Occurrence</th>
                                            </tr>
                                        </thead>
                                        <tbody id="movementTableBody">
                                            <!-- Les lignes seront insérées ici -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
                            <div class="card flex-fill w-100">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Type de trame</h5>
                                </div>
                                <div class="card-body d-flex">
                                    <div class="align-self-center w-100">
                                        <div class="py-3">
                                            <div class="chart chart-xs">
                                                <canvas id="chartjs-dashboard-pie"></canvas>
                                            </div>
                                        </div>

                                        <table class="table mb-0">
                                            <tbody id="table-body">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-12 col-xxl-6 d-flex order-3 order-xxl-2">
                            <div class="card flex-fill w-100">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Real-Time</h5>
                                </div>
                                <div class="card-body px-4">
                                    <div id="world_map" style="height:350px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 col-xxl-3 d-flex order-1 order-xxl-1">
                            <div class="card flex-fill">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Calendar</h5>
                                </div>
                                <div class="card-body d-flex">
                                    <div class="align-self-center w-100">
                                        <div class="chart">
                                            <div id="datetimepicker-dashboard"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-lg-8 col-xxl-9 d-flex card-body-ip">
                            <div class="card flex-fill">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Adresse IP</h5>
                                </div>
                                <div class="row">
                                    <div class="col-12 col-md-6">
                                        <table id="srcTable" class="table table-hover my-0">
                                            <thead>
                                                <tr>
                                                    <th>Adresses source</th>
                                                    <th class="d-none d-xl-table-cell">Occurences</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Adresses destination</td>
                                                    <td class="d-none d-xl-table-cell">Occurences</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <table id="dstTable" class="table table-hover my-0">
                                            <thead>
                                                <tr>
                                                    <th>Adresses destination</th>
                                                    <th class="d-none d-xl-table-cell">Occurences</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Adresses destination</td>
                                                    <td class="d-none d-xl-table-cell">Occurences</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-4 col-xxl-3 d-flex">
                            <div class="card flex-fill w-100">
                                <div class="card-header">

                                    <h5 class="card-title mb-0">Kerberos services</h5>
                                </div>
                                <div class="card-body d-flex w-100">
                                    <div class="align-self-center chart chart-lg">
                                        <canvas id="chartjs-dashboard-bar"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="">
                    <div class="d-flex">
                        <div class="card flex-fill">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Ports TCP sources / distants</h5>
                            </div>
                            <div class="row">
                                <div class="col-12 col-md-6">
                                    <canvas id="srcChart"></canvas>
                                    <p class="align-center">Sources</p>
                                </div>
                                <div class="col-12 col-md-6">
                                    <canvas id="dstChart"></canvas>
                                    <p>Distants</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="js/app.js"></script>


    <script>
        let displayData = (data) => {
            console.log(data);
            console.log(data.src_addresses);

            function sortData(data) {
                return Object.entries(data)
                    .sort((a, b) => b[1] - a[1])
                    .reduce((sortedObj, [key, value]) => {
                        sortedObj[key] = value;
                        return sortedObj;
                    }, {});
            }

            function populateTable(tableId, data) {
                const tableBody = document.querySelector(`#${tableId} tbody`);
                tableBody.innerHTML = '';

                Object.entries(data).forEach(([address, occurrences]) => {
                    const row = document.createElement('tr');

                    const addressCell = document.createElement('td');

                    const link = document.createElement('a');
                    link.href = `http://localhost:8101/analyzeIP?ip=${address}`;
                    link.textContent = address;
                    link.target = "_blank";

                    addressCell.appendChild(link);
                    row.appendChild(addressCell);

                    const occurrencesCell = document.createElement('td');
                    occurrencesCell.classList.add('d-none', 'd-xl-table-cell');
                    occurrencesCell.textContent = occurrences;
                    row.appendChild(occurrencesCell);

                    tableBody.appendChild(row);
                });
            }


            const sortedSrcAddresses = sortData(data.src_addresses);
            const sortedDstAddresses = sortData(data.dst_addresses);

            populateTable('srcTable', sortedSrcAddresses);
            populateTable('dstTable', sortedDstAddresses);


            const logsLength = document.querySelector("#logs_length");
            logsLength.innerHTML = data.logs_length;

            new Chart(document.getElementById("chartjs-dashboard-pie"), {
                type: "pie",
                data: {
                    labels: ["Trames Ethernet", "Trames IPv4", "Trames UDP", "Trames TCP", "Trames Kerberos"],
                    datasets: [{
                        data: [data.ethernet_frames, data.ipv4_frames, data.udp_frames, data.tcp_frames, data.kerberos_frames],
                        backgroundColor: [
                            "#3498db",
                            "#f39c12",
                            "#e74c3c",
                            "#2ecc71",
                            "#1abc9c"
                        ],
                        borderWidth: 5
                    }]
                },
                options: {
                    responsive: !window.MSInputMethodContext,
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    cutoutPercentage: 75
                }
            });

            const tableBody = document.getElementById("table-body");
            tableBody.innerHTML = `
        <tr>
            <td>Ethernet</td>
            <td class="text-end">${data.ethernet_frames}</td>
        </tr>
        <tr>
            <td>IPv4</td>
            <td class="text-end">${data.ipv4_frames}</td>
        </tr>
        <tr>
            <td>UDP</td>
            <td class="text-end">${data.udp_frames}</td>
        </tr>
        <tr>
            <td>TCP</td>
            <td class="text-end">${data.tcp_frames}</td>
        </tr>
        <tr>
            <td>Kerberos</td>
            <td class="text-end">${data.kerberos_frames}</td>
        </tr>
    `;

            const labels = Object.keys(data.kerberos_services);
            const occ = Object.values(data.kerberos_services);

            new Chart(document.getElementById("chartjs-dashboard-bar"), {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: "Logs en cours",
                        backgroundColor: window.theme.primary,
                        borderColor: window.theme.primary,
                        hoverBackgroundColor: window.theme.primary,
                        hoverBorderColor: window.theme.primary,
                        data: occ,
                        barPercentage: 0.75,
                        categoryPercentage: 0.5
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    legend: {
                        display: false
                    },
                    scales: {
                        yAxes: [{
                            gridLines: {
                                display: false
                            },
                            stacked: false,
                            ticks: {
                                stepSize: 5
                            }
                        }],
                        xAxes: [{
                            stacked: false,
                            gridLines: {
                                color: "transparent"
                            }
                        }]
                    }
                }
            });

            const ipCoordinates = data.ip_coordinates || [];
            console.log(ipCoordinates);

            const markers = ipCoordinates.filter(coord => coord.latitude !== null && coord.longitude !== null)
                .map(coord => ({
                    coords: [coord.latitude, coord.longitude],
                    name: coord.ip
                }));

            var map = new jsVectorMap({
                map: "world",
                selector: "#world_map",
                zoomButtons: true,
                markers: markers,
                markerStyle: {
                    initial: {
                        r: 9,
                        strokeWidth: 7,
                        stokeOpacity: .4,
                        fill: window.theme.primary
                    },
                    hover: {
                        fill: window.theme.primary,
                        stroke: window.theme.primary
                    }
                },
                zoomOnScroll: false
            });

            window.addEventListener("resize", () => {
                map.updateSize();
            });



            function sortUrlData(urlLabels, urlOcc) {
                const combined = urlLabels.map((label, index) => [label, urlOcc[index]]);

                combined.sort((a, b) => b[1] - a[1]);

                const sortedLabels = combined.map(item => item[0]);
                const sortedOcc = combined.map(item => item[1]);

                return { sortedLabels, sortedOcc };
            }

            const urlLabels = Object.keys(data.url);
            const urlOcc = Object.values(data.url);

            const { sortedLabels, sortedOcc } = sortUrlData(urlLabels, urlOcc);

            const tableurlBody = document.getElementById('movementTableBody');

            sortedLabels.forEach((label, index) => {
                const row = document.createElement('tr');
                const urlCell = document.createElement('td');
                const occurrenceCell = document.createElement('td');

                const urlLink = document.createElement('a');
                urlLink.href = `analyzeURL?urls=${encodeURIComponent(label)}`;
                urlLink.textContent = label;
                urlLink.target = '_blank';

                urlCell.appendChild(urlLink);

                occurrenceCell.textContent = sortedOcc[index];

                row.appendChild(urlCell);
                row.appendChild(occurrenceCell);

                tableurlBody.appendChild(row);
            });

            const srcLabels = Object.keys(data.tcp_ports);
            const srcOccurrences = Object.values(data.tcp_ports);

            const dstLabels = Object.keys(data.dst_ports);
            const dstOccurrences = Object.values(data.dst_ports);

            const colors = [
                "#ff6384", "#36a2eb", "#ffcd56", "#2ecc71", "#1abc9c",
                "#f39c12", "#e74c3c", "#9b59b6", "#3498db", "#1abc9c",
                "#16a085", "#2ecc71", "#f1c40f", "#e67e22", "#95a5a6",
                "#34495e", "#f39c12", "#9b59b6", "#8e44ad", "#2980b9",
                "#2c3e50", "#c0392b", "#16a085", "#27ae60", "#8e44ad",
                "#f39c12", "#1abc9c", "#9b59b6", "#e74c3c", "#16a085",
            ];

            const srcData = {
                labels: srcLabels,
                datasets: [{
                    data: srcOccurrences,
                    backgroundColor: colors.slice(0, srcLabels.length),
                    hoverBackgroundColor: colors.slice(0, srcLabels.length),
                }]
            };

            const dstData = {
                labels: dstLabels,
                datasets: [{
                    data: dstOccurrences,
                    backgroundColor: colors.slice(0, dstLabels.length),
                    hoverBackgroundColor: colors.slice(0, dstLabels.length),
                }]
            };


            const ctxSrc = document.getElementById('srcChart').getContext('2d');
            const srcChart = new Chart(ctxSrc, {
                type: 'doughnut',
                data: srcData,
                options: {
                    cutoutPercentage: 50,
                }
            });

            const ctxDst = document.getElementById('dstChart').getContext('2d');
            const dstChart = new Chart(ctxDst, {
                type: 'doughnut',
                data: dstData,
                options: {
                    cutoutPercentage: 50,
                }
            });

        }

        fetch('http://localhost:8101/dashboard')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                displayData(data);
            })
            .catch(error => {
                console.error('Error fetching dashboard:', error);
            });


    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var date = new Date(Date.now() - 5 * 24 * 60 * 60 * 1000);
            var defaultDate = date.getUTCFullYear() + "-" + (date.getUTCMonth() + 1) + "-" + date.getUTCDate();
            document.getElementById("datetimepicker-dashboard").flatpickr({
                inline: true,
                prevArrow: "<span title=\"Previous month\">&laquo;</span>",
                nextArrow: "<span title=\"Next month\">&raquo;</span>",
                defaultDate: defaultDate
            });
        });
    </script>


<script src="js/app.js"></script>

<script>
   
   
    function downloadPCAP() {
    fetch("http://localhost:8101/fetch-logs")
        .then(response => response.text())
        .then(message => {
            alert(message); // te montre "Fichier téléchargé avec succès : ./src/Logs/logs"
        })
        .catch(error => alert("Erreur de téléchargement depuis l'API : " + error));
    }

    function uploadPCAP() {
    const fileInput = document.getElementById("pcapFileInput");
    const file = fileInput.files[0];

    if (!file) {
        alert("Veuillez sélectionner un fichier PCAP.");
        return;
    }

    const formData = new FormData();
    formData.append("file", file);

    fetch("http://localhost:8101/upload", {
        method: "POST",
        body: formData
    })
    .then(response => {
        // On vérifie si le backend retourne bien du JSON
        const contentType = response.headers.get("content-type");
        if (contentType && contentType.indexOf("application/json") !== -1) {
            return response.json();
        } else {
            return response.text().then(text => { throw new Error(text); });
        }
    })
    .then(result => {
        // Si success = true dans le JSON
        if (result.success) {
            alert(result.message); // ex: Fichier PCAP importé sur le serveur : ./src/Logs/logs
        } else {
            alert("Erreur : " + result.message);
        }
    })
    .catch(error => {
        console.error("Erreur upload :", error);
        alert("Erreur inattendue lors de l'import : " + error.message);
    });
    }



    function analyzePCAP() {
        fetch("http://localhost:8101/analyze")
            .then(response => {
                if (!response.ok) throw new Error("Erreur d'analyse");
                return response.json();
            })
            .then(data => {
                displayData(data);
            })
            .catch(error => alert("Erreur d'analyse : Failed to fetch"));
    }

    

    fetch('http://localhost:8101/dashboard')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            displayData(data);
        })
        .catch(error => {
            console.error('Error fetching dashboard:', error);
        });
</script>

<script>
    
    function uploadPCAP() {
    const fileInput = document.getElementById("pcapFileInput");
    const file = fileInput.files[0];

    if (!file) {
        alert("Veuillez sélectionner un fichier PCAP.");
        return;
    }

    const formData = new FormData();
    formData.append("file", file);

    fetch("http://localhost:8101/upload", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(result => {
        alert(result.message);
        console.log(result);
    })
    .catch(error => {
        alert("Erreur JS : " + error.message);
        console.error(error);
    });
}



    function analyzePCAP() {
        // 1. On décode les logs
        fetch("http://localhost:8101/decode-logs")
            .then(response => {
                if (!response.ok) throw new Error("Échec du décodage");
                return response.text();
            })
            .then(() => {
                // 2. Puis on recharge la page pour voir les nouvelles données
                window.location.reload();
            })
            .catch(error => alert("Erreur lors de l'analyse : " + error.message));
    }
</script>


<style>
    
    .dashboard-card {
    min-height: 200px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
    margin-bottom: 20px;
}


.dashboard-card .card-body {
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}


.dashboard-card h5 {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 15px;
}

.dashboard-card h1 {
    font-size: 2rem;
    font-weight: bold;
    margin: 0;
}

.dashboard-card input[type="file"] {
    margin-bottom: 10px;
    width: 90%;
    text-align: center;
}

</style>

    

</body>
</html>



</body>

</html>